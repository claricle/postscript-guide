---
layout: default
title: setmatrix
parent: Coordinate Transformations
grand_parent: Command Reference
nav_order: 9
---

== setmatrix

Replaces the current transformation matrix with a specified matrix.

=== Syntax

----
matrix setmatrix → -
----

=== Stack Effects

.Before
[cols="1,3"]
|===
| Level | Object

| 0
| `matrix` (6-element array)
|===

.After
[cols="1,3"]
|===
| Level | Object

| (empty)
| No results
|===

=== Description

link:setmatrix.adoc[`setmatrix`] replaces the current transformation matrix (CTM) in the graphics state with the value of `matrix`.

This establishes an arbitrary transformation from user space to device space without reference to the former CTM. The `matrix` operand must be a 6-element array of numbers representing a transformation matrix.

WARNING: Except in device setup procedures, use of link:setmatrix.adoc[`setmatrix`] should be very rare. PostScript programs should ordinarily modify the CTM using xref:translate.adoc[`translate`], xref:scale.adoc[`scale`], xref:rotate.adoc[`rotate`], and xref:concat.adoc[`concat`] rather than replace it.

=== PostScript Level

*Level 1* and later

=== Examples

.Setting a specific matrix
[source,postscript]
----
[2 0 0 2 100 100] setmatrix
% CTM is now exactly [2 0 0 2 100 100]
----

.Restoring saved matrix
[source,postscript]
----
matrix currentmatrix
/savedCTM exch def

% ... transformations ...

savedCTM setmatrix  % Restore CTM
----

.Resetting to default
[source,postscript]
----
matrix defaultmatrix setmatrix
% Equivalent to: initmatrix
----

=== Common Use Cases

==== Restoring Saved State

[source,postscript]
----
% Save CTM
matrix currentmatrix /originalCTM exch def

% Complex nested transformations
gsave
  100 100 translate
  2 2 scale
  % ... more transformations ...
grestore

% Restore exact original CTM
originalCTM setmatrix
----

==== Setting Absolute Transformation

[source,postscript]
----
% Set specific transformation regardless of current state
[1.5 0 0 1.5 200 300] setmatrix
% CTM is now exactly this matrix
----

==== Device Setup

[source,postscript]
----
% In device initialization (rare)
/myDeviceMatrix [72 0 0 -72 0 792] def
myDeviceMatrix setmatrix
----

=== Common Pitfalls

WARNING: *Breaks Encapsulation* - link:setmatrix.adoc[`setmatrix`] can break assumptions about coordinate system.

[source,postscript]
----
% Dangerous in nested procedures
/proc1 {
  100 100 translate
  proc2  % Assumes translation is in effect
} def

/proc2 {
  matrix defaultmatrix setmatrix  % Destroys proc1's transformation!
} def
----

WARNING: *Use concat Instead* - Usually you want to modify, not replace, the CTM.

[source,postscript]
----
% Wrong - replaces CTM:
[2 0 0 2 0 0] setmatrix

% Right - modifies CTM:
[2 0 0 2 0 0] concat
% Or better:
2 2 scale
----

WARNING: *Not Saved by gsave* - Well, actually it is, but that's the point:

[source,postscript]
----
gsave
  [1 0 0 1 0 0] setmatrix
  % Transformation in effect
grestore
% Transformation undone - setmatrix changes are saved/restored
----

TIP: *Prefer Transform Operators* - Use transformation operators instead of link:setmatrix.adoc[`setmatrix`]:

[source,postscript]
----
% Instead of:
[2 0 0 2 100 200] setmatrix

% Use:
100 200 translate
2 2 scale
----

TIP: *Valid Use Case* - Restoring a saved matrix is the primary valid use:

[source,postscript]
----
matrix currentmatrix  % Save
/saved exch def
% ... operations ...
saved setmatrix       % Restore
----

=== Error Conditions

[cols="1,3"]
|===
| Error | Condition

| [`rangecheck`]
| Array does not have exactly 6 elements, or matrix values exceed implementation limits

| [`stackunderflow`]
| No operand on stack

| [`typecheck`]
| Operand is not an array, or array elements are not all numbers
|===

=== Implementation Notes

* The CTM is stored internally in device space
* Very large or very small matrix values may cause precision issues
* Degenerate matrices (determinant = 0) create non-invertible transformations
* The matrix operand is not modified
* Unlike xref:concat.adoc[`concat`], link:setmatrix.adoc[`setmatrix`] completely replaces the CTM

=== Matrix Format

The matrix [a b c d tx ty] transforms coordinates:

----
x' = a×x + c×y + tx
y' = b×x + d×y + ty
----

Where:

* `a`, `d`: scaling factors
* `b`, `c`: rotation/shear components
* `tx`, `ty`: translation components

=== Why setmatrix Is Rarely Needed

In well-structured PostScript programs:

1. **Initialization**: Device setup uses xref:initmatrix.adoc[`initmatrix`]
2. **Modifications**: Use xref:translate.adoc[`translate`], xref:scale.adoc[`scale`], xref:rotate.adoc[`rotate`], xref:concat.adoc[`concat`]
3. **State Management**: Use xref:../graphics-state/gsave.adoc[`gsave`]/xref:../graphics-state/grestore.adoc[`grestore`]
4. **Restoration**: Use xref:../graphics-state/grestore.adoc[`grestore`] or saved matrix with link:setmatrix.adoc[`setmatrix`]

=== Comparison with Other Operators

[source,postscript]
----
% setmatrix - replaces CTM
[2 0 0 2 100 100] setmatrix
% CTM = [2 0 0 2 100 100]

% concat - multiplies with CTM
matrix currentmatrix  % Assume [1 0 0 1 0 0]
[2 0 0 2 100 100] concat
% CTM = [2 0 0 2 100 100] × [1 0 0 1 0 0]
%     = [2 0 0 2 100 100]

% In this case same result, but concat respects existing CTM
----

=== Performance Considerations

* Very fast operation
* No matrix computation required
* Just replaces 6 values in graphics state
* No different in performance from xref:concat.adoc[`concat`]

=== See Also

* xref:currentmatrix.adoc[`currentmatrix`] - Get current CTM
* xref:defaultmatrix.adoc[`defaultmatrix`] - Get device default matrix
* xref:initmatrix.adoc[`initmatrix`] - Reset CTM to default
* xref:concat.adoc[`concat`] - Concatenate matrix with CTM
* xref:translate.adoc[`translate`] - Move origin
* xref:scale.adoc[`scale`] - Change unit size
* xref:rotate.adoc[`rotate`] - Rotate axes
* xref:../graphics-state/gsave.adoc[`gsave`] - Save graphics state
* xref:../graphics-state/grestore.adoc[`grestore`] - Restore graphics state