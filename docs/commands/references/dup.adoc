---
layout: default
title: dup
parent: Command Reference
nav_order: 3
---
= dup

Duplicates the top element on the operand stack, creating a second copy.

== Description

The `dup` operator creates a copy of the topmost element on the operand stack and pushes it onto the stack. This is one of the most frequently used stack manipulation operators in PostScript.

*Important*: `dup` copies only the object itself, not the value of composite objects. For arrays, dictionaries, and strings, both the original and the duplicate reference the same underlying value. Changes to the value through either reference will be visible through both.

This is a Level 1 operator, available in all PostScript implementations.

== Syntax

[source,postscript]
----
any dup any any
----

=== Stack Effect

.Before Execution
[cols="1,3"]
|===
|Position |Content

|Top
|`any` (any type) - The element to duplicate
|===

.After Execution
[cols="1,3"]
|===
|Position |Content

|Top
|`any` - Copy of the original element

|Top-1
|`any` - The original element
|===

== Parameters

`any`:: Any PostScript object of any type. The object will be duplicated on the stack.

== Return Values

Two identical references to the same object. For composite objects, both references share the same underlying value.

== Examples

=== Basic Usage

[source,postscript]
----
% Duplicate a number
42 dup          % Stack: 42 42

% Duplicate a string
(hello) dup     % Stack: (hello) (hello)

% Use duplicate for calculation
5 dup mul       % Stack: 25 (5 squared)
----

=== Using Both Copies

[source,postscript]
----
% Calculate x^2 + x
10 dup          % Stack: 10 10
dup mul         % Stack: 10 100
exch            % Stack: 100 10
add             % Stack: 110
----

=== Composite Object Sharing

[source,postscript]
----
% Arrays share values
[1 2 3] dup     % Stack: [1 2 3] [1 2 3]
0 99 put        % Modify first array
                % Both arrays now: [99 2 3]

% To make independent copy, use copy instead
[1 2 3]
dup length array copy   % True independent copy
----

=== Common Pattern with Operators

[source,postscript]
----
% Keep value while testing it
/x 100 def
x dup 0 gt {    % Test if positive
    % Use duplicated value
    sqrt        % Take square root
} {
    pop         % Discard if negative
    0           % Return 0 instead
} ifelse
----

== Advanced Examples

=== Multiple Duplication

[source,postscript]
----
% Create three copies of a value
/triple {       % any -> any any any
    dup dup
} def

5 triple        % Stack: 5 5 5
----

=== Safe Division with Check

[source,postscript]
----
% Divide, but check for zero divisor
/safeDivide {   % numerator denominator -> result
    dup 0 eq {
        pop pop     % Remove both operands
        (Error: Division by zero) print
        0           % Return 0 or some default
    } {
        div
    } ifelse
} def

10 2 safeDivide     % Stack: 5.0
10 0 safeDivide     % Prints error, stack: 0
----

=== Preserving Value for Multiple Operations

[source,postscript]
----
% Calculate both sin and cos of an angle
/sinCos {       % angle -> sin cos
    dup         % angle angle
    sin         % angle sin
    exch        % sin angle
    cos         % sin cos
} def

45 sinCos       % Stack: 0.707... 0.707...
----

=== Building Complex Structures

[source,postscript]
----
% Create a dictionary with self-reference
/makeCircular {
    5 dict dup              % dict dict
    begin
        /self currentdict def
    end
} def
----

== Edge Cases and Common Pitfalls

WARNING: Using `dup` on an empty stack causes a `stackunderflow` error.

=== Empty Stack

[source,postscript]
----
% BAD: No elements to duplicate
clear
dup             % ERROR: stackunderflow
----

=== Composite Object Pitfall

[source,postscript]
----
% BAD: Unexpected sharing
[1 2 3] dup     % Stack: [1 2 3] [1 2 3]
0 99 put        % Modify "first" array
% Stack: [99 2 3] [99 2 3]
% BOTH arrays are modified!

% GOOD: Create independent copy when needed
[1 2 3]
dup length array copy   % True independent copy
0 99 put        % Only one array modified
----

TIP: Remember that `dup` creates a shallow copy. For composite objects (arrays, dictionaries, strings), use the link:/docs/commands/references/copy/[`copy`] operator when you need an independent copy of the value.

=== Dictionary Sharing

[source,postscript]
----
% Be aware of shared dictionary values
5 dict dup              % Both references point to same dictionary
/a 1 put                % Affects both references
% Both dict references now have entry a:1
----

== Related Commands

* link:/docs/commands/references/exch/[`exch`] - Exchange top two elements
* link:/docs/commands/references/copy/[`copy`] - Copy multiple elements or create independent copies
* link:/docs/commands/[`index`] - Duplicate nth element from top
* link:/docs/commands/references/roll/[`roll`] - Rotate stack elements
* link:/docs/commands/references/pop/[`pop`] - Remove top element

== PostScript Level

*Available in*: PostScript Level 1 and higher

This is a fundamental operator available in all PostScript implementations.

== Error Conditions

`stackunderflow`::
The operand stack is empty when `dup` is executed. There must be at least one element on the stack.
+
[source,postscript]
----
clear
dup             % ERROR: stackunderflow
----

`stackoverflow`::
The operand stack has reached its maximum capacity and cannot accommodate another element.
+
[source,postscript]
----
% (Extremely rare in practice)
% Occurs only if stack is nearly full
----

== Performance Considerations

The `dup` operator is extremely fast and has negligible performance impact. It's a basic stack operation with O(1) constant time complexity.

For composite objects, `dup` only copies the reference, not the entire value, making it very efficient even for large arrays or dictionaries.

== Best Practices

1. **Use for calculations**: `dup` is essential when you need the same value multiple times in a calculation
2. **Understand object vs. value**: Remember that `dup` copies the object (reference), not the value for composite types
3. **Document stack effects**: Clearly document when procedures use `dup` to duplicate values
4. **Consider copy for independence**: Use link:/docs/commands/references/copy/[`copy`] when you need an independent copy of a composite object
5. **Combine with conditionals**: The pattern `dup ... { ... } { ... } ifelse` is very common

=== Good Stack Management

[source,postscript]
----
% Document when values are duplicated
/square {       % x -> x^2
    dup mul
} def

/cube {         % x -> x^3
    dup dup mul mul
} def

% Clear documentation prevents confusion
/pythagorean {  % x y -> sqrt(x^2 + y^2)
    dup mul     % x y^2
    exch        % y^2 x
    dup mul     % y^2 x^2
    add sqrt    % result
} def
----

== See Also

* link:/docs/syntax/operators/[Operators Overview] - Understanding PostScript operators
* link:/docs/usage/basic/stack-operations/[Stack Operations Guide] - Stack manipulation tutorial
* link:/docs/usage/basic/composite-objects/[Composite Objects] - Understanding object vs. value copying
* link:/docs/commands/references/[Stack Manipulation] - All stack operators
