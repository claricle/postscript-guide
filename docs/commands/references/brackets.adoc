---
layout: default
title: "`[` ... `]` (Array Brackets)"
parent: Command Reference
nav_order: 2
---

== `[` and `]` (Array Brackets)

Array construction operators that work together to create literal arrays in PostScript.

=== Overview

The bracket operators `[` and `]` provide the most convenient syntax for constructing arrays with known contents:

* `[` marks the beginning of array construction by pushing a mark on the operand stack
* `]` ends array construction by collecting all objects above the mark into a new array

These operators are typically used together as a pair to define literal arrays in PostScript code.

=== Syntax

==== [ (Left Bracket)

----
– [ → mark
----

==== ] (Right Bracket)

----
mark obj₀ ... objₙ₋₁ ] → array
----

=== Stack Effects

==== [ (Left Bracket)

.Before
[cols="1,3"]
|===
| Level | Object

| (empty or any objects)
|
|===

.After
[cols="1,3"]
|===
| Level | Object

| 0
| `mark` (array construction marker)
|===

==== ] (Right Bracket)

.Before
[cols="1,3"]
|===
| Level | Object

| n+1
| `mark`

| n
| `obj₀`

| ...
| ...

| 0
| `objₙ₋₁`
|===

.After
[cols="1,3"]
|===
| Level | Object

| 0
| `array` (containing obj₀ through objₙ₋₁)
|===

=== Description

==== How Array Construction Works

The `[` operator pushes a special mark object on the operand stack to indicate the beginning of an array being constructed. It is functionally equivalent to the link:/docs/commands/references/mark/[`mark`] operator, but its use with `]` gives it special significance for array construction.

The `]` operator completes array construction by:

1. Counting all objects on the operand stack down to the topmost mark
2. Removing those objects from the stack
3. Creating a new array containing those objects in order
4. Removing the mark
5. Pushing the new array on the stack

The resulting array is created with the literal attribute and allocated in local or global VM according to the current VM allocation mode.

=== PostScript Level

*Level 1* and later

=== Examples

.Simple array construction
[source,postscript]
----
[ 1 2 3 ]        % Creates array [1 2 3]
----

.Mixed-type array
[source,postscript]
----
[ 42 (hello) /name true ]  % Array with different types
----

.Nested arrays
[source,postscript]
----
[ 1 [ 2 3 ] 4 ]  % Array containing another array
% Result: [1 [2 3] 4]
----

.Empty array
[source,postscript]
----
[ ]              % Creates empty array []
----

.Computed values in arrays
[source,postscript]
----
[ 1 2 add 3 4 mul ]  % Expressions evaluated before array creation
% Result: [3 12]

[ 10 20 add 30 ]     % Creates [30 30]
----

.Building array from existing stack values
[source,postscript]
----
1 2 3            % Stack: 1 2 3
mark exch exch exch  % Stack: mark 1 2 3
]                % Stack: [1 2 3]
----

=== Common Use Cases

==== Literal Data Structures

[source,postscript]
----
/colors [ /red /green /blue ] def
/coordinates [ 100 200 ] def
/primes [ 2 3 5 7 11 13 ] def
----

==== Procedure Arguments

[source,postscript]
----
[ 1 2 3 ] { 10 mul } forall  % Pass array to forall
----

==== Matrix Definitions

[source,postscript]
----
[ 1 0 0 1 0 0 ]  % Identity transformation matrix
----

==== Coordinate Pairs and Points

[source,postscript]
----
/point [ 100 200 ] def
----

==== Color Definitions

[source,postscript]
----
/red [ 1 0 0 ] def      % RGB
/cyan [ 0 1 1 1 ] def   % CMYK
----

=== Common Pitfalls

WARNING: *Unmatched Brackets* - Every `[` must have a corresponding `]`. Unmatched brackets cause a [`syntaxerror`] or [`unmatchedmark`] error.

[source,postscript]
----
[ 1 2 3   % Missing ] causes syntaxerror
1 2 3 ]   % Missing [ causes unmatchedmark error
----

WARNING: *Execution vs. Literal* - Objects between `[` and `]` are evaluated before being placed in the array.

[source,postscript]
----
[ 1 2 add ]      % Results in [3], not [1 2 add]

[ /x 5 def ]     % Executes def, creates [5]
                 % NOT [/x 5 def]
----

TIP: *Literal vs. Executable Arrays* - Arrays created by `[ ... ]` have the literal attribute by default. To create an array without evaluating its contents, use the procedure syntax `{ ... }`. Use link:/docs/commands/references/cvx/[`cvx`] to make a literal array executable if needed.

[source,postscript]
----
/proc { 1 2 add } def   % Procedure (unevaluated)
[ 1 2 add ]             % Array [3] (evaluated)
----

=== Error Conditions

[cols="1,3"]
|===
| Error | Condition

| [`stackoverflow`]
| Operand stack overflow when pushing mark, or resulting array would overflow stack

| [`syntaxerror`]
| No matching `]` before end of file/string

| [`unmatchedmark`]
| No mark on stack when `]` is executed (no matching `[`)

| [`VMerror`]
| Insufficient VM to allocate array
|===

=== Implementation Notes

* The `[` operator is functionally equivalent to link:/docs/commands/references/mark/[`mark`]
* The `]` operator is syntactic sugar recognized during parsing
* Marks are used for error recovery and can be detected with link:/docs/commands/references/counttomark/[`counttomark`]
* When scanned, `[ ... ]` creates a literal array object
* The objects are placed in the array in the order they appeared between brackets
* Index 0 contains the first object after `[`
* The interpreter treats `[` and `]` specially during scanning for array literal syntax

=== Relationship to Other Operators

==== Equivalence with mark

The `[` operator is functionally equivalent to link:/docs/commands/references/mark/[`mark`]:

[source,postscript]
----
mark 1 2 3 ]     % Same as [ 1 2 3 ]
[ 1 2 3          % Must be closed with ]
----

However, `[` and `]` provide clearer syntax for array construction.

==== Comparison with astore

The `]` operator is similar to link:/docs/commands/references/astore/[`astore`] but more convenient:

[source,postscript]
----
% Using [ ]
[ 1 2 3 ]

% Equivalent using astore
1 2 3 3 array astore
----

The bracket syntax is clearer and doesn't require knowing the count in advance.

=== See Also

* link:/docs/commands/references/mark/[`mark`] - Push mark object
* link:/docs/commands/references/cleartomark/[`cleartomark`] - Clear to mark
* link:/docs/commands/references/counttomark/[`counttomark`] - Count objects to mark
* link:/docs/commands/references/array/[`array`] - Create uninitialized array
* link:/docs/commands/references/astore/[`astore`] - Store stack into array
* link:/docs/commands/references/packedarray/[`packedarray`] - Create read-only array