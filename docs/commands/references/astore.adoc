---
layout: default
title: astore
parent: Command Reference
nav_order: 5
---

== astore

Stores stack elements into an array.

=== Syntax

----
any₀ ... anyₙ₋₁ array astore → array
----

=== Stack Effects

.Before
[cols="1,3"]
|===
| Level | Object

| n
| `any₀`

| ...
| ...

| 1
| `anyₙ₋₁`

| 0
| `array` (length n)
|===

.After
[cols="1,3"]
|===
| Level | Object

| 0
| `array` (filled with any₀ through anyₙ₋₁)
|===

=== Description

link:/docs/commands/references/astore/[`astore`] stores objects from the operand stack into an array:

1. Removes the array from the stack and determines its length _n_
2. Removes _n_ objects from the stack
3. Stores them into the array (topmost stack element → array[n-1], bottommost → array[0])
4. Pushes the array back onto the stack

The array must have been previously created with the correct length. link:/docs/commands/references/astore/[`astore`] cannot be performed on packed arrays (they are read-only).

=== PostScript Level

*Level 1* and later

=== Examples

.Basic storage
[source,postscript]
----
(a) (bcd) (ef) 3 array astore
% Result: [(a) (bcd) (ef)]
----

.Building array from computations
[source,postscript]
----
10 20 add   % 30
30 40 add   % 70
50 60 add   % 110
3 array astore
% Result: [30 70 110]
----

.Coordinate storage
[source,postscript]
----
100 200 2 array astore
/point exch def  % Store as /point
----

=== Common Use Cases

==== Matrix Construction

[source,postscript]
----
1 0 0 1 0 0 6 array astore  % Identity matrix
/identitymatrix exch def
----

==== Collecting Results

[source,postscript]
----
% Collect multiple function results
func1  % Returns value1
func2  % Returns value2
func3  % Returns value3
3 array astore  % [value1 value2 value3]
----

==== Parameter Arrays

[source,postscript]
----
/red 1 def /green 0 def /blue 0 def
red green blue 3 array astore
/rgbcolor exch def
----

=== Common Pitfalls

WARNING: *Array Size Must Match* - The array must be exactly the right size for the number of objects on the stack.

[source,postscript]
----
1 2 3 4 array astore  % Only stores 3 items
% 4th element remains null
----

WARNING: *Stack Order* - Objects are stored in reverse stack order: topmost stack element → highest array index.

[source,postscript]
----
1 2 3 3 array astore  % Result: [1 2 3]
                       % NOT [3 2 1]
----

WARNING: *Global/Local VM Restrictions* - If the array is in global VM and any stored object is in local VM, [`invalidaccess`] error occurs.

TIP: *Pre-create Array* - Always create the array first with the correct size using link:/docs/commands/references/array/[`array`].

=== Error Conditions

[cols="1,3"]
|===
| Error | Condition

| [`invalidaccess`]
| Array is in global VM and contains local VM objects, or array is read-only

| [`stackunderflow`]
| Fewer than n+1 objects on stack

| [`typecheck`]
| Operand is not an array
|===

=== Implementation Notes

* Cannot be used with packed arrays (they are read-only)
* Elements are stored by reference (not copied) for composite objects
* The array is modified in place
* Most efficient for small to medium-sized arrays

=== Comparison with [ ]

[source,postscript]
----
% Using astore
1 2 3 3 array astore  % [1 2 3]

% Using [ ]
[ 1 2 3 ]             % [1 2 3] (more convenient)
----

The `[ ]` syntax is usually more convenient for literal arrays, but link:/docs/commands/references/astore/[`astore`] is useful when the array size is computed dynamically.

=== See Also

* link:/docs/commands/references/aload/[`aload`] - Load array elements onto stack
* link:/docs/commands/references/array/[`array`] - Create new array
* link:/docs/commands/references/put/[`put`] - Put single value into array
* link:/docs/commands/references/putinterval/[`putinterval`] - Put subarray into array
* link:/docs/commands/references/brackets/[`[`] / link:/docs/commands/references/brackets/[`]`] - Array literal syntax