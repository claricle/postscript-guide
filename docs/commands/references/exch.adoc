---
layout: default
title: exch
parent: Command Reference
nav_order: 2
---
= exch

Exchanges the positions of the top two elements on the operand stack.

== Description

The `exch` operator swaps the top two elements on the operand stack. This is one of the most frequently used stack manipulation operators, essential for reordering operands before applying binary operations.

This is a Level 1 operator, available in all PostScript implementations.

== Syntax

[source,postscript]
----
any1 any2 exch any2 any1
----

=== Stack Effect

.Before Execution
[cols="1,3"]
|===
|Position |Content

|Top
|`any2` (any type) - Second element to exchange

|Top-1
|`any1` (any type) - First element to exchange
|===

.After Execution
[cols="1,3"]
|===
|Position |Content

|Top
|`any1` - Originally second element, now on top

|Top-1
|`any2` - Originally top element, now second
|===

== Parameters

`any1`:: Any PostScript object of any type. Will become the second element after exchange.

`any2`:: Any PostScript object of any type. Will become the top element after exchange.

== Return Values

The same two objects, but with their positions swapped.

== Examples

=== Basic Usage

[source,postscript]
----
% Simple exchange
1 2 exch        % Stack: 2 1

% Exchange strings
(hello) (world) exch    % Stack: (world) (hello)
----

=== Preparing for Division

[source,postscript]
----
% Compute 10 / 2 (result should be 5)
2 10            % Stack: 2 10
exch            % Stack: 10 2
div             % Stack: 5.0
----

=== Reordering for Subtraction

[source,postscript]
----
% Compute 10 - 3 (not 3 - 10)
3 10            % Stack: 3 10
exch            % Stack: 10 3
sub             % Stack: 7
----

=== Working with Dictionaries

[source,postscript]
----
% Store value in dictionary with key on top
/mydict 10 dict def
42              % Value to store
/answer         % Key
exch            % Stack: /answer 42
mydict 3 1 roll % Stack: /answer mydict 42
put             % Store answer: 42 in mydict
----

== Advanced Examples

=== Conditional Exchange

[source,postscript]
----
% Exchange only if first is greater than second (sort)
/conditionalExch {  % a b -> min max
    2 copy lt {     % If a < b
        % Already in order, do nothing
    } {
        exch        % Swap them
    } ifelse
} def

% Usage
5 3 conditionalExch     % Stack: 3 5 (sorted)
2 8 conditionalExch     % Stack: 2 8 (already sorted)
----

=== Three-Element Rotation

[source,postscript]
----
% Rotate three elements: a b c -> c a b
/rotate3 {      % a b c -> c a b
    exch        % a c b
    3 1 roll    % c a b
} def

% Usage
1 2 3 rotate3   % Stack: 3 1 2
----

=== Duplicate and Exchange Pattern

[source,postscript]
----
% Common pattern: duplicate top, then get second
/dupExch {      % a b -> a b a
    dup         % a b b
    3 1 roll    % b a b
    exch        % b b a
    pop         % b a
} def
----

== Edge Cases and Common Pitfalls

WARNING: Using `exch` with fewer than two elements on the stack causes a `stackunderflow` error.

=== Stack Underflow

[source,postscript]
----
% BAD: Not enough elements
clear 5         % Stack: 5
exch            % ERROR: stackunderflow
----

=== Excessive Exchange

[source,postscript]
----
% BAD: Multiple exchanges cancel out
1 2 exch exch   % Stack: 1 2 (back where we started)
% Better to not exchange at all
----

TIP: Remember that two consecutive `exch` operations cancel each other out. If you find yourself doing this, reconsider your stack management strategy.

=== Type Confusion

[source,postscript]
----
% Be careful with type-sensitive operations
10 (hello) exch % Stack: (hello) 10
add             % ERROR: typecheck (can't add string and number)
----

== Related Commands

* link:/docs/commands/references/dup/[`dup`] - Duplicate top element before exchanging
* link:/docs/commands/references/roll/[`roll`] - General stack rotation for multiple elements
* link:/docs/commands/[`index`] - Access elements deeper in the stack
* link:/docs/commands/references/pop/[`pop`] - Remove top element
* link:/docs/commands/references/copy/[`copy`] - Copy multiple stack elements

== PostScript Level

*Available in*: PostScript Level 1 and higher

This is a fundamental operator available in all PostScript implementations.

== Error Conditions

`stackunderflow`::
There are fewer than two elements on the operand stack when `exch` is executed.
+
[source,postscript]
----
clear
5 exch          % ERROR: stackunderflow
----

== Performance Considerations

The `exch` operator is extremely fast and has negligible performance impact. It's a basic stack operation with O(1) constant time complexity. Use it freely without performance concerns.

== Best Practices

1. **Use for binary operations**: `exch` is essential when operands are in the wrong order for binary operations like `sub`, `div`, `atan`
2. **Combine with dup**: The pattern `dup ... exch` is very common for operations that need the same value twice
3. **Consider roll for multiple elements**: If you're exchanging more than two elements, `roll` might be more appropriate
4. **Document stack effects**: When using `exch` in procedures, clearly document the before/after stack state
5. **Avoid redundant exchanges**: Two consecutive `exch` operations are a no-op

=== Clear Stack Effect Comments

[source,postscript]
----
% Good practice: document stack effects
/hypotenuse {   % x y -> sqrt(x^2 + y^2)
    dup mul     % x y^2
    exch        % y^2 x
    dup mul     % y^2 x^2
    add         % x^2+y^2
    sqrt        % result
} def
----

== See Also

* link:/docs/syntax/operators/[Operators Overview] - Understanding PostScript operators
* link:/docs/usage/basic/stack-operations/[Stack Operations Guide] - Stack manipulation tutorial
* link:/docs/commands/references/[Stack Manipulation] - All stack operators
