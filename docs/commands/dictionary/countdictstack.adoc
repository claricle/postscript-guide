---
layout: default
title: countdictstack
parent: Dictionary Operations
grand_parent: Command Reference
nav_order: 11
---

== countdictstack

Returns the number of dictionaries currently on the dictionary stack.

=== Syntax

----
– countdictstack → int
----

=== Stack Effects

.Before
[cols="1,3"]
|===
| Level | Object

| (none)
|
|===

.After
[cols="1,3"]
|===
| Level | Object

| 0
| `int` (number of dictionaries on dict stack)
|===

=== Description

[`countdictstack`](countdictstack.adoc) counts the number of dictionaries currently on the dictionary stack and pushes this count onto the operand stack.

The count includes all dictionaries: permanent system dictionaries and any pushed by [`begin`](begin.adoc).

=== PostScript Level

*Level 1* and later

=== Examples

.Basic count
[source,postscript]
----
countdictstack  % Typically returns 2 or 3
                % (systemdict, [globaldict,] userdict)
----

.With nested dictionaries
[source,postscript]
----
countdictstack  % Returns e.g. 3
dict1 begin
  countdictstack  % Returns 4
  dict2 begin
    countdictstack  % Returns 5
  end
end
----

.Verifying balance
[source,postscript]
----
countdictstack /savedCount exch def
dict begin
  % ... operations ...
end
countdictstack savedCount eq  % Should be true
----

=== Common Use Cases

==== Stack Balance Verification

[source,postscript]
----
/withBalancedDict {  % dict proc =>
  countdictstack 3 1 roll
  begin
    stopped { end } if
  end
  countdictstack eq not {
    /dictstackimbalance cvx exec
  } if
} def
----

==== Debugging

[source,postscript]
----
/showDictStack {
  (Dictionary stack depth: ) print
  countdictstack =
} def
----

==== Cleanup Verification

[source,postscript]
----
countdictstack /initialDepth exch def
% ... complex operations ...
countdictstack initialDepth sub {
  end  % Pop extra dictionaries
} repeat
----

=== Common Pitfalls

WARNING: *Includes Permanent Dictionaries* - Count includes systemdict, globaldict (Level 2), and userdict.

[source,postscript]
----
% Minimum stack depth varies by level:
% Level 1: 2 (systemdict, userdict)
% Level 2: 3 (systemdict, globaldict, userdict)
----

TIP: *Use for Defensive Programming* - Check dictionary stack balance in error handlers.

=== Error Conditions

[cols="1,3"]
|===
| Error | Condition

| [`stackoverflow`]
| No room on operand stack (extremely rare)
|===

=== Implementation Notes

* Very fast operation (simple counter)
* Does not modify dictionary stack
* Typical maximum depth: 20-250 dictionaries (implementation-dependent)

=== Minimum Stack Depths

[cols="2,3"]
|===
| PostScript Level | Minimum Depth

| Level 1
| 2 (systemdict, userdict)

| Level 2
| 3 (systemdict, globaldict, userdict)
|===

=== See Also

* xref:dictstack.adoc[`dictstack`] - Copy dict stack to array
* xref:begin.adoc[`begin`] - Push dictionary
* xref:end.adoc[`end`] - Pop dictionary
* xref:currentdict.adoc[`currentdict`] - Get current dictionary
* xref:../stack-manipulation/count.adoc[`count`] - Count operand stack depth