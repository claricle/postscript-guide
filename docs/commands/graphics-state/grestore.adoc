---
layout: default
title: grestore
parent: Graphics State
grand_parent: Command Reference
nav_order: 2
---

== grestore

Restores the graphics state from the top of the graphics state stack.

=== Syntax

----
– grestore → –
----

=== Stack Effects

.Before/After
[cols="1,3"]
|===
| Level | Object

| (none)
| Graphics state stack decreased by one, current state restored
|===

=== Description

link:grestore.adoc[`grestore`] resets the current graphics state from the one on top of the graphics state stack and pops that stack.

If there is no matching link:gsave.adoc[`gsave`], or if the most recent link:gsave.adoc[`gsave`] preceded the most recent unmatched `save`, link:grestore.adoc[`grestore`] does not pop the stack, but still restores the state from the top.

=== PostScript Level

*Level 1* and later

=== Examples

.Basic restore
[source,postscript]
----
gsave
  2 setlinewidth
  0.5 setgray
  % Draw something
grestore
% Line width and gray restored
----

.Multiple levels
[source,postscript]
----
gsave
  1 setlinewidth
  gsave
    5 setlinewidth
  grestore  % Back to 1
grestore    % Back to original
----

.After save
[source,postscript]
----
/mysave save def
gsave
  % State changes
grestore  % Doesn't pop (save intervened)
mysave restore  % Restores including gsave level
----

=== Common Use Cases

==== Isolating Modifications

[source,postscript]
----
/drawElement {
  gsave
    applyTransforms
    applyColors
    renderElement
  grestore
} def
----

==== Clipping Regions

[source,postscript]
----
gsave
  clipPath clip
  % Draw clipped content
grestore
% Clip path restored
----

==== Color Isolation

[source,postscript]
----
gsave
  1 0 0 setrgbcolor
  fillShape
grestore
% Original color restored
----

=== Common Pitfalls

WARNING: *Must Have Matching gsave* - Unmatched link:grestore.adoc[`grestore`] doesn't error but doesn't pop stack.

[source,postscript]
----
grestore  % No matching gsave
% State restored from top but stack not popped
----

WARNING: *save Intervenes* - link:grestore.adoc[`grestore`] after `save` doesn't pop stack.

[source,postscript]
----
gsave
save
grestore  % Doesn't pop due to save
restore   % Pops graphics state stack
----

TIP: *Always Pair with gsave* - Use link:gsave.adoc[`gsave`]/link:grestore.adoc[`grestore`] pairs consistently.

=== Error Conditions

[cols="1,3"]
|===
| Error | Condition

| (none directly)
| No errors generated by grestore itself
|===

=== Implementation Notes

* Restores all graphics state parameters atomically
* Fast operation
* Common pattern in PostScript programs
* Stack-based state management

=== What Gets Restored

All parameters saved by link:gsave.adoc[`gsave`]:
* CTM, path, current point
* Clipping path
* Color space and color
* Font
* All line parameters
* All device-dependent parameters

=== See Also

* xref:../gsave.adoc[`gsave`] - Save graphics state
* xref:../grestoreall.adoc[`grestoreall`] - Restore all levels
* xref:../setgstate.adoc[`setgstate`] - Set from gstate object
* `save`, `restore` - VM and graphics state